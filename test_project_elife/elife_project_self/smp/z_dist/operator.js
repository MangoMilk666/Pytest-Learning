(()=>{"use strict";var e,t,a,s={541:(e,t,a)=>{var s=a(294);const n=new class{constructor(){this.subscribers=[]}subscribe(e){this.subscribers.push(e)}broadcast(e,t){for(let a of this.subscribers)a.handleDCEvent(e,t)}};var i={};async function l(e,t="get",a={},s=!0,n={},l=!1){let r={method:t,...n};if("get"===t){let t=new URLSearchParams(a).toString();if(t.length>0&&(e+="?"+t),l&&(delete r.trycache,i.hasOwnProperty(e)))return i[e]}else r.headers=r.headers?r.headers:{},r.headers={"Content-Type":"application/json",...r.headers},r.body=JSON.stringify(a);s&&(r.headers={Authorization:"Bearer "+sessionStorage.elifeToken,...r.headers});const m=await fetch(e,r);if(401===m.status)return sessionStorage.setItem("redirect-from",window.location.href),void(window.top.location.href="/login.html");if(200!==m.status)throw alert("HTTP 错误 : "+m.status),"HTTP 错误 : "+m.status;let c=await m.json();if(0!=c.ret&&c.ret>0)throw alert(c.msg),c.msg;return n.trycache&&(i[e]=c),c}function r(e){var t=window.location.hash.split("?")[1];if(!t)return null;for(var a=t.split("&"),s=0;s<a.length;s++){var n=a[s].split("=");if(decodeURIComponent(n[0])==e)return decodeURIComponent(n[1])}return null}function m(e,t){let[a,s]=window.location.hash.split("?");const n=new URLSearchParams(s);n.delete(e),n.set(e,t),window.location.hash=a+"?"+n.toString()}class c extends s.Component{constructor(e){super(e),this.state={myProfile:{nickname:sessionStorage.nickname}},n.subscribe(this)}handleDCEvent(e,t){"modify_my_profile"===e&&this.setState({myProfile:t})}render(){return s.createElement(s.Fragment,null,s.createElement("a",{style:{minWidth:"8.5rem",textAlign:"center"}},this.state.myProfile.nickname?this.state.myProfile.nickname:"管理员"),s.createElement("ul",{className:"dropdown-menu hidden"},s.createElement("li",{className:"menu-item"},s.createElement("a",{href:"#/myprofile"},"我的信息")),s.createElement("div",{className:"dropdown-divider"}),s.createElement("li",{className:"menu-item",onClick:e=>{sessionStorage.clear(),location.href="/login.html"}},"退出")))}}class d extends s.Component{constructor(e){super(e),this.state={addOneFormHide:!0,curPageNum:1,pagecount:0,gotoPageNum:"",pageItemList:[],pageItemModify:{}}}async deleteItem(e){confirm("确定要删除本记录吗？")&&(await l(`/api/operator/${this.api_name}/delete`,"delete",{id:e}),this.getItemList(this.state.curPageNum))}async getItemList(e=1,t=5,a=""){this.setState({pageItemList:[]});var s=await l(`/api/operator/${this.api_name}/list?pagesize=${t}&pagenum=${e}&keywords=${a}`);let n=Math.ceil(s.total/t);this.processPageItemList&&this.processPageItemList(s.retlist),this.setState({curPageNum:e,pagecount:n,pageItemList:s.retlist})}componentDidMount(){this.getItemList()}render(){return s.createElement(s.Fragment,null,s.createElement("div",{className:"add-one-area"},s.createElement("span",{className:"btn",onClick:()=>{this.setState({addOneFormHide:!this.state.addOneFormHide})}},this.state.addOneFormHide?"添加":"取消"),s.createElement("div",{className:this.state.addOneFormHide?"add-one-form hidden":"add-one-form"},this.genAddOneItemGUI(),s.createElement("div",{className:"add-one-submit-btn-div"},s.createElement("span",{className:"btn",onClick:()=>{this.addOneSubmit()}},"确定")))),0===this.state.pagecount?null:s.createElement("div",{className:"paginator"},s.createElement("span",{id:"curpage-totalpage",style:{color:"olive"}},"第",this.state.curPageNum,"页，共",this.state.pagecount,"页"),s.createElement("span",{className:"btn-no-border "+(1===this.state.curPageNum?"disable":""),onClick:()=>{1!==this.state.curPageNum&&this.getItemList(this.state.curPageNum-1)}},"上一页"),s.createElement("span",{className:"btn-no-border "+(this.state.curPageNum===this.state.pagecount?"disable":""),onClick:()=>{this.state.curPageNum!==this.state.pagecount&&this.getItemList(this.state.curPageNum+1)}},"下一页"),s.createElement("input",{type:"number",style:{width:"3rem"},min:"1",onChange:e=>{this.setState({gotoPageNum:e.target.value})},onKeyDown:e=>{if("Enter"!==e.key)return;let t=parseInt(this.state.gotoPageNum.trim());this.getItemList(t)}}),s.createElement("span",{id:"gotoPage",className:"btn-no-border",onClick:()=>{let e=parseInt(this.state.gotoPageNum.trim());this.getItemList(e)}},"跳转")),s.createElement("div",{className:"result-list"},0===this.state.pagecount?s.createElement("p",{style:{fontSize:"1.2rem"}},"系统中还没有相应数据"):this.state.pageItemList.map((e=>s.createElement("div",{className:"result-list-item",key:e.id},this.genOneItemInnerElement(e))))))}}class o extends d{api_name="device";constructor(e){super(e),this.state.curTypeDeviceModelListWhenAdd=[],this.deviceTypeList=[],this.svcRuleList=[],this.deviceTypeId2Models={}}async componentDidMount(){await this.getDeviceTypeList(),await this.getSvcRuleList(),this.getItemList()}async getDeviceTypeList(){var e=await l("/api/operator/devicetype/list");this.deviceTypeList=e.retlist}async getSvcRuleList(){var e=await l("/api/operator/svcrule/list");this.svcRuleList=e.retlist}async getDeviceModelList(e){if(this.deviceTypeId2Models.hasOwnProperty(e))return this.deviceTypeId2Models[e];var t=await l(`/api/operator/devicemodel/listbytype?devicetypeid=${e}`);return this.deviceTypeId2Models[e]=t.retlist,t.retlist}genAddOneItemGUI(){return s.createElement(s.Fragment,null,s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"设备类型"),s.createElement("select",{id:"device-type",size:"4",className:"input-xl",onChange:async e=>{let t=parseInt(e.target.value);this.setState({curTypeDeviceModelListWhenAdd:[]}),this.setState({curTypeDeviceModelListWhenAdd:await this.getDeviceModelList(t)})}},this.deviceTypeList.map((e=>s.createElement("option",{key:e.id,value:e.id},e.name))))),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"设备型号"),s.createElement("select",{id:"device-model",size:"5",className:"input-xl"},this.state.curTypeDeviceModelListWhenAdd.map((e=>s.createElement("option",{key:e.id,value:e.id},e.name))))),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"业务规则"),s.createElement("select",{id:"svc-rule-id",size:"5",className:"input-xl"},this.svcRuleList.map((e=>s.createElement("option",{key:e.id,value:e.id},e.name))))),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"设备编号"),s.createElement("input",{type:"text",id:"device-sn",className:"input-xl"})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"设备描述"),s.createElement("input",{type:"text",id:"device-desc",className:"input-xl"})))}async addOneSubmit(){let e=parseInt(document.querySelector("#device-model").value),t=document.querySelector("#device-sn").value,a=document.querySelector("#device-desc").value,s=parseInt(document.querySelector("#svc-rule-id").value);e?t?(await l("/api/operator/device/add","post",{device_model_id:e,svc_rule_id:s,sn:t,desc:a}),this.getItemList()):alert("请填写设备编号"):alert("请选择设备型号")}genOneItemInnerElement(e){let t=this.state.pageItemModify[e.id];return t?s.createElement(s.Fragment,null,s.createElement("div",{className:"result-list-item-info"},s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"类型"),s.createElement("select",{size:"4",className:"input-xl",value:t.typeid,onChange:async e=>{t.curTypeDeviceModelList=[],this.forceUpdate(),t.typeid=parseInt(e.target.value),t.curTypeDeviceModelList=await this.getDeviceModelList(t.typeid),t.curTypeDeviceModelList.length>0&&(t.modelid=t.curTypeDeviceModelList[0].id),this.forceUpdate()}},this.deviceTypeList.map((e=>s.createElement("option",{key:e.id,value:e.id},e.name))))),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"型号"),s.createElement("select",{size:"5",className:"input-xl",value:t.modelid,onChange:e=>{t.modelid=parseInt(e.target.value),this.forceUpdate()}},t.curTypeDeviceModelList.map((e=>s.createElement("option",{key:e.id,value:e.id},e.name))))),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"业务规则"),s.createElement("select",{size:"5",className:"input-xl",value:t.svc_rule_id,onChange:e=>{t.svc_rule_id=parseInt(e.target.value),this.forceUpdate()}},this.svcRuleList.map((e=>s.createElement("option",{key:e.id,value:e.id},e.name))))),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"编号"),s.createElement("input",{value:t.sn,onChange:e=>{t.sn=e.target.value,this.forceUpdate()}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"描述"),s.createElement("input",{value:t.desc,onChange:e=>{t.desc=e.target.value,this.forceUpdate()}}))),s.createElement("div",{className:"result-list-item-btn-bar"},s.createElement("span",{className:"btn-no-border",onClick:()=>{this.modifyOneSubmit(t,e)}},"确定"),s.createElement("span",{className:"btn-no-border",onClick:()=>{delete this.state.pageItemModify[e.id],this.forceUpdate()}},"取消"))):s.createElement(s.Fragment,null,s.createElement("div",{className:"result-list-item-info"},s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"类型"),s.createElement("span",{className:"field-value"},e.typename)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"型号"),s.createElement("span",{className:"field-value"},e.modelname)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"编号"),s.createElement("span",{className:"field-value"},e.sn)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"密钥"),s.createElement("span",{className:"field-value",style:{cursor:"pointer",color:"#03a9f4"},onClick:async()=>{if(!confirm("确定要更新密钥吗？"))return;let t=await l("/api/operator/device/update_sharedkey","put",{id:e.id});e.share_secret=t.share_secret,this.forceUpdate()}},e.share_secret)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"业务规则"),s.createElement("span",{className:"field-value",style:{cursor:"pointer",color:"#03a9f4"},onClick:()=>{location.hash="#/svcrule?ruleid="+e.svc_rule_id}},e.svc_rule_name)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"描述"),s.createElement("span",{className:"field-value"},e.desc))),s.createElement("div",{className:"result-list-item-btn-bar"},s.createElement("span",{className:"btn-no-border",onClick:()=>{this.deleteItem(e.id)}},"删除"),s.createElement("span",{className:"btn-no-border",onClick:async()=>{this.state.pageItemModify[e.id]=JSON.parse(JSON.stringify(e)),this.state.pageItemModify[e.id].curTypeDeviceModelList=await this.getDeviceModelList(e.typeid),this.forceUpdate()}},"修改"),s.createElement("span",{className:"btn-no-border",onClick:()=>{location.hash="#/svcrecord?devicesn="+e.sn}},"消费")))}async modifyOneSubmit(e,t){await l("/api/operator/device/modify","put",{id:t.id,device_model_id:e.modelid,svc_rule_id:e.svc_rule_id,sn:e.sn,desc:e.desc}),delete this.state.pageItemModify[t.id],this.getItemList(this.state.curPageNum)}}class p extends d{api_name="devicemodel";constructor(e){super(e),this.deviceTypeList=[]}componentDidMount(){this.getDeviceTypeList(),this.getItemList()}async getDeviceTypeList(){var e=await l("/api/operator/devicetype/list");this.deviceTypeList=e.retlist,this.forceUpdate()}getDTNameById(e){for(const t of this.deviceTypeList)if(t.id===e)return t.name;return"未知类型"}genAddOneItemGUI(){return s.createElement(s.Fragment,null,s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"设备种类"),s.createElement("select",{id:"device-type",size:"4",className:"input-xl"},this.deviceTypeList.map((e=>s.createElement("option",{key:e.id,value:e.id},e.name))))),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"设备型号"),s.createElement("input",{type:"text",id:"device-model",className:"input-xl"})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"型号描述"),s.createElement("input",{type:"text",id:"device-model-desc",className:"input-xl"})))}async addOneSubmit(){let e=parseInt(document.querySelector("#device-type").value),t=document.querySelector("#device-model").value,a=document.querySelector("#device-model-desc").value;await l("/api/operator/devicemodel/add","post",{dtypeid:e,name:t,desc:a}),this.getItemList()}genOneItemInnerElement(e){let t=this.state.pageItemModify[e.id];return t?s.createElement(s.Fragment,null,s.createElement("div",{className:"edit-one-form"},s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"设备种类"),s.createElement("select",{id:"device-type",size:"4",className:"input-xl",value:t.typeid,onChange:e=>{t.typeid=parseInt(e.target.value),this.forceUpdate()}},this.deviceTypeList.map((e=>s.createElement("option",{key:e.id,value:e.id},e.name))))),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"设备型号"),s.createElement("input",{value:t.name,className:"input-xl",onChange:e=>{t.name=e.target.value,this.forceUpdate()}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"型号描述"),s.createElement("input",{value:t.desc,className:"input-xl",onChange:e=>{t.desc=e.target.value,this.forceUpdate()}}))),s.createElement("div",{className:"result-list-item-btn-bar"},s.createElement("span",{className:"btn-no-border",onClick:()=>{this.modifyOneSubmit(t,e)}},"确定"),s.createElement("span",{className:"btn-no-border",onClick:()=>{delete this.state.pageItemModify[e.id],this.forceUpdate()}},"取消"))):s.createElement(s.Fragment,null,s.createElement("div",{className:"result-list-item-info"},s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"设备类型"),s.createElement("span",{className:"field-value"},e.typename)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"设备型号"),s.createElement("span",{className:"field-value"},e.name)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"描述"),s.createElement("span",{className:"field-value"},e.desc))),s.createElement("div",{className:"result-list-item-btn-bar"},s.createElement("span",{className:"btn-no-border",onClick:()=>{this.deleteItem(e.id)}},"删除"),s.createElement("span",{className:"btn-no-border",onClick:()=>{this.state.pageItemModify[e.id]=JSON.parse(JSON.stringify(e)),this.forceUpdate()}},"修改")))}async modifyOneSubmit(e,t){await l("/api/operator/devicemodel/modify","put",{id:t.id,dtypeid:e.typeid,name:e.name,desc:e.desc}),delete this.state.pageItemModify[t.id],this.getItemList(this.state.curPageNum)}}class u extends d{api_name="svcrule";constructor(e){super(e),this.ruleid=r("ruleid"),this.state.addSvcRule={name:"",desc:"",rule_type_id:0,rule_type:null,charge_rule:{minFee:0,estFee:0,feeRates:[{svcCode:"",unitName:"",unitPrice:0}]}},this.svcRuleTypeList=[]}async componentDidMount(){await this.getSvcRuleTypeList(),this.getItemList(1,5,"",this.ruleid)}async getItemList(e=1,t=5,a="",s=null){this.setState({pageItemList:[]});let n=`/api/operator/${this.api_name}/list?pagesize=${t}&pagenum=${e}&keywords=${a}`;s&&(n+="&ruleid="+s);var i=await l(n);let r=Math.ceil(i.total/t);this.processPageItemList&&this.processPageItemList(i.retlist),this.setState({curPageNum:e,pagecount:r,pageItemList:i.retlist})}processPageItemList(e){for(let t of e)t.charge_rule=JSON.parse(t.charge_rule)}async getSvcRuleTypeList(){var e=await l("/api/operator/svcruletype/list");this.svcRuleTypeList=e.retlist,this.state.addSvcRule.rule_type=this.svcRuleTypeList[0],this.state.addSvcRule.rule_type_id=this.svcRuleTypeList[0].id,this.forceUpdate()}getSvcRuleTypeById(e){for(const t of this.svcRuleTypeList)if(t.id===e)return t;return null}add_modify_part(e){return s.createElement(s.Fragment,null,s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"规则名称"),s.createElement("input",{value:e.name,onChange:t=>{e.name=t.target.value,this.forceUpdate()}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"规则类型"),s.createElement("select",{id:"rule_type_id",size:"4",className:"input-xl",value:e.rule_type_id,onChange:t=>{let a=parseInt(t.target.value);e.rule_type_id=a,e.rule_type=this.getSvcRuleTypeById(a),e.charge_rule.feeRates=[{svcCode:"",unitName:"",unitPrice:0}],this.forceUpdate()}},this.svcRuleTypeList.map((e=>s.createElement("option",{key:e.id,value:e.id},e.name))))),e.rule_type?s.createElement(s.Fragment,null,"pre"===e.rule_type.paytype?s.createElement(s.Fragment,null,s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"最小消费"),s.createElement("input",{type:"number",size:"6",value:e.charge_rule.minFee,onChange:t=>{e.charge_rule.minFee=parseFloat(t.target.value),this.forceUpdate()}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"预估消费"),s.createElement("input",{type:"number",size:"6",value:e.charge_rule.estFee,onChange:t=>{e.charge_rule.estFee=parseFloat(t.target.value),this.forceUpdate()}}))):null,2===e.rule_type_id?null:s.createElement("div",{className:"fee-rate-list"},e.charge_rule.feeRates.map(((t,a,n)=>s.createElement("div",{className:"fee-rate",style:{margin:".8rem 0"},key:a},1===e.rule_type_id?null:s.createElement(s.Fragment,null,s.createElement("span",{style:{margin:"0 .5rem"}},"业务码"),s.createElement("input",{type:"text",size:"8",value:t.svcCode,onChange:e=>{t.svcCode=e.target.value,this.forceUpdate()}})),s.createElement("span",{style:{margin:"0 .5rem"}},"计费单位"),s.createElement("input",{type:"text",size:"8",value:t.unitName,onChange:e=>{t.unitName=e.target.value,this.forceUpdate()}}),s.createElement("span",{style:{margin:"0 .5rem"}},"单位价格"),s.createElement("input",{type:"number",style:{width:"5rem"},value:t.unitPrice,onChange:e=>{t.unitPrice=parseFloat(e.target.value),this.forceUpdate()}}),1===e.rule_type_id?null:s.createElement("span",{style:{margin:"0 0 0 .5rem",padding:"0 .5rem",color:"red",cursor:"pointer"},onClick:e=>{n.splice(a,1),this.forceUpdate()}},"X")))),1===e.rule_type_id&&1===e.charge_rule.feeRates.length?null:s.createElement("div",null,s.createElement("button",{onClick:t=>{e.charge_rule.feeRates.push({svcCode:"",unitName:"",unitPrice:0}),this.forceUpdate()}},"添加费率")))):null,s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"规则描述"),s.createElement("input",{value:e.desc,onChange:t=>{e.desc=t.target.value,this.forceUpdate()}})))}genAddOneItemGUI(){return this.add_modify_part(this.state.addSvcRule)}renderChargeRuleJson(e){return s.createElement(s.Fragment,null,"minFee"in e?s.createElement("div",{style:{margin:".5rem 0"}},s.createElement("span",{className:"sub-field-name"},"最小消费"),s.createElement("span",{className:"field-value"},e.minFee)):null,"estFee"in e?s.createElement("div",{style:{margin:".5rem 0"}},s.createElement("span",{className:"sub-field-name"},"预估消费"),s.createElement("span",{className:"field-value"},e.estFee)):null,e.feeRates?s.createElement("div",{style:{margin:".5rem 0"}},s.createElement("span",{className:"sub-field-name"},"费率"),s.createElement("div",{style:{margin:".5rem"}},e.feeRates.map(((e,t)=>s.createElement("div",{key:t,style:{margin:".8rem 0",display:"grid",gridTemplateColumns:e.svcCode?"repeat(3, 1fr)":"repeat(2, 1fr)"}},e.svcCode?s.createElement("span",{className:"sub-field-value"},"业务码：",e.svcCode):null,s.createElement("span",{className:"sub-field-value"},"单位：",e.unitName," "),s.createElement("span",{className:"sub-field-value"},"单价：",e.unitPrice)))))):null)}genOneItemInnerElement(e){let t=this.state.pageItemModify[e.id];return t?s.createElement(s.Fragment,null,s.createElement("div",{className:"result-list-item-info"},this.add_modify_part(t)),s.createElement("div",{className:"result-list-item-btn-bar"},s.createElement("span",{className:"btn-no-border",onClick:()=>{this.modifyOneSubmit(t,e)}},"确定"),s.createElement("span",{className:"btn-no-border",onClick:()=>{delete this.state.pageItemModify[e.id],this.forceUpdate()}},"取消"))):s.createElement(s.Fragment,null,s.createElement("div",{className:"result-list-item-info"},s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"规则名称"),s.createElement("span",{className:"field-value"},e.name)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"规则类型"),s.createElement("span",{className:"field-value"},this.getSvcRuleTypeById(e.rule_type_id).name)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"规则内容"),s.createElement("span",{className:"field-value"},this.renderChargeRuleJson(e.charge_rule))),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"规则描述"),s.createElement("span",{className:"field-value"},e.desc))),s.createElement("div",{className:"result-list-item-btn-bar"},s.createElement("span",{className:"btn-no-border",onClick:()=>{this.deleteItem(e.id)}},"删除"),s.createElement("span",{className:"btn-no-border",onClick:()=>{this.state.pageItemModify[e.id]=JSON.parse(JSON.stringify(e));let t=this.state.pageItemModify[e.id];t.rule_type=this.getSvcRuleTypeById(t.rule_type_id),this.forceUpdate()}},"修改")))}async addOneSubmit(){let e=JSON.parse(JSON.stringify(this.state.addSvcRule));"post"===e.rule_type.paytype&&(delete e.charge_rule.minFee,delete e.charge_rule.estFee),2===e.rule_type_id&&delete e.charge_rule.feeRates,await l("/api/operator/svcrule/add","post",{name:e.name,rule_type_id:parseFloat(e.rule_type_id),charge_rule:JSON.stringify(e.charge_rule,null,2),desc:e.desc}),this.getItemList()}async modifyOneSubmit(e,t){let a=JSON.parse(JSON.stringify(e));"post"===a.rule_type.paytype&&(delete a.charge_rule.minFee,delete a.charge_rule.estFee),2===a.rule_type_id&&delete a.charge_rule.feeRates,await l("/api/operator/svcrule/modify","put",{id:t.id,name:a.name,rule_type_id:a.rule_type_id,charge_rule:JSON.stringify(a.charge_rule,null,2),desc:a.desc}),delete this.state.pageItemModify[t.id],this.getItemList(this.state.curPageNum)}}class h extends s.Component{api_name="svcrecord";constructor(e){super(e);let t=r("devicesn"),a=r("username");this.state={curPageNum:1,pagecount:0,gotoPageNum:"",pageItemList:[],devTypeId:0,devModelId:0,devSn:t||"",userName:a||"",startDate:"",endDate:"",deviceTypeList:[{id:0,name:"（不选）"}],curTypeDeviceModelList:[{id:0,name:"（不选）"}]},this.deviceTypeId2Models={0:[{id:0,name:"（不选）"}]}}async getDeviceTypeList(){var e=await l("/api/operator/devicetype/list");this.setState({deviceTypeList:[{id:0,name:"（不选）"},...e.retlist]})}async getDeviceModelList(e){if(this.deviceTypeId2Models.hasOwnProperty(e))return this.deviceTypeId2Models[e];let t=[{id:0,name:"（不选）"},...(await l(`/api/operator/devicemodel/listbytype?devicetypeid=${e}`)).retlist];return this.deviceTypeId2Models[e]=t,t}componentDidMount(){this.getDeviceTypeList(),this.getItemList()}genOneItemInnerElement(e){return s.createElement(s.Fragment,null,s.createElement("div",{className:"result-list-item-info"},s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"账号"),s.createElement("span",{className:"field-value"},e.username)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"设备"),s.createElement("span",{className:"field-value"},e.device_desc)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"时间"),s.createElement("span",{className:"field-value"},e.end_time)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"金额"),s.createElement("span",{className:"field-value"},e.fee)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"描述"),s.createElement("span",{className:"field-value"},e.sr_desc))),s.createElement("div",{className:"result-list-item-btn-bar"},s.createElement("span",{className:"btn-no-border",onClick:()=>{}},"查看")))}async getItemList(e=1,t=5){this.setState({pageItemList:[]});let a="";0!=this.state.devTypeId&&(a+="&devicetypeid="+this.state.devTypeId),0!=this.state.devModelId&&(a+="&devicemodelid="+this.state.devModelId),""!=this.state.devSn&&(a+="&devicesn="+this.state.devSn),""!=this.state.userName&&(a+="&username="+this.state.userName),""!=this.state.startDate&&(a+="&startdate="+this.state.startDate),""!=this.state.endDate&&(a+="&enddate="+this.state.endDate);let s=`/api/operator/${this.api_name}/list?pagesize=${t}&pagenum=${e}`;a.length>0&&(s+=a);var n=await l(s);let i=Math.ceil(n.total/t);this.setState({curPageNum:e,pagecount:i,pageItemList:n.retlist})}render(){return s.createElement(s.Fragment,null,s.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",alignItems:"center"}},s.createElement("div",{style:{display:"flex",gap:"1rem"}},s.createElement("div",{style:{display:"flex",gap:"1rem"}},s.createElement("span",null,"设备类型"),s.createElement("select",{className:"input-l",size:"5",style:{width:"12rem"},value:this.state.devTypeId,onChange:async e=>{let t=parseInt(e.target.value);this.setState({devTypeId:t,devModelId:0,curTypeDeviceModelList:[]}),this.setState({curTypeDeviceModelList:await this.getDeviceModelList(t)})}},this.state.deviceTypeList.map((e=>s.createElement("option",{key:e.id,value:e.id},e.name))))),s.createElement("div",{style:{display:"flex",gap:"1rem"}},s.createElement("span",null,"设备型号"),s.createElement("select",{className:"input-l",size:5,style:{width:"12rem"},value:this.state.devModelId,onChange:e=>{this.setState({devModelId:parseInt(e.target.value)})}},this.state.curTypeDeviceModelList.map((e=>s.createElement("option",{key:e.id,value:e.id},e.name)))))),s.createElement("div",{style:{display:"flex",gap:"1rem"}},s.createElement("div",{style:{display:"flex",gap:"1rem"}},s.createElement("span",null,"设备编号"),s.createElement("input",{size:23,value:this.state.devSn,onChange:e=>{m("devicesn",e.target.value),this.setState({devSn:e.target.value})}})),s.createElement("div",{style:{display:"flex",gap:"1rem"}},s.createElement("span",null,"用户账号"),s.createElement("input",{size:23,value:this.state.userName,onChange:e=>{m("username",e.target.value),this.setState({userName:e.target.value})}}))),s.createElement("div",{style:{display:"flex",gap:"1rem"}},s.createElement("div",{style:{display:"flex",gap:"1rem"}},s.createElement("span",null,"开始时间"),s.createElement("input",{type:"date",style:{width:"11.8rem"},value:this.state.startDate,onChange:e=>this.setState({startDate:e.target.value})})),s.createElement("div",{style:{display:"flex",gap:"1rem"}},s.createElement("span",null,"结束时间"),s.createElement("input",{type:"date",style:{width:"11.8rem"},value:this.state.endDate,onChange:e=>this.setState({endDate:e.target.value})}))),s.createElement("span",{className:"btn",style:{width:"3rem"},onClick:e=>{this.getItemList()}},"查询")),0===this.state.pagecount?null:s.createElement("div",{className:"paginator"},s.createElement("span",{id:"curpage-totalpage",style:{color:"olive"}},"第",this.state.curPageNum,"页，共",this.state.pagecount,"页"),s.createElement("span",{className:"btn-no-border "+(1===this.state.curPageNum?"disable":""),onClick:()=>{1!==this.state.curPageNum&&this.getItemList(this.state.curPageNum-1)}},"上一页"),s.createElement("span",{className:"btn-no-border "+(this.state.curPageNum===this.state.pagecount?"disable":""),onClick:()=>{this.state.curPageNum!==this.state.pagecount&&this.getItemList(this.state.curPageNum+1)}},"下一页"),s.createElement("input",{type:"number",style:{width:"3rem"},min:"1",onChange:e=>{this.setState({gotoPageNum:e.target.value})},onKeyDown:e=>{if("Enter"!==e.key)return;let t=parseInt(this.state.gotoPageNum.trim());this.getItemList(t)}}),s.createElement("span",{id:"gotoPage",className:"btn-no-border",onClick:()=>{let e=parseInt(this.state.gotoPageNum.trim());this.getItemList(e)}},"跳转")),s.createElement("div",{className:"result-list"},0===this.state.pagecount?s.createElement("p",{style:{fontSize:"1.2rem"}}," 没有找到记录数据 "):this.state.pageItemList.map((e=>s.createElement("div",{className:"result-list-item",key:e.id},this.genOneItemInnerElement(e))))))}}class g extends s.Component{constructor(e){super(e),this.state={myProfile:{},status:"display",myProfile_Editing:{},mpass:{oldpass:"",newpass:"",confpass:""}}}async getMyProfile(){var e=await l("/api/operator/get_my_profile");this.setState({myProfile:e.profile})}componentDidMount(){this.getMyProfile()}render_display(){let e=this.state.myProfile;return s.createElement(s.Fragment,null,s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"昵称"),s.createElement("span",{className:"field-value"},e.nickname?e.nickname:"管理员")),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"简介"),s.createElement("span",{className:"field-value"},e.desc?e.desc:"--")),s.createElement("div",{className:"field"},s.createElement("span",{className:"btn-outlined",style:{marginRight:"2rem"},onClick:e=>{let t=JSON.parse(JSON.stringify(this.state.myProfile));this.setState({status:"edit_profile",myProfile_Editing:t})}},"修改信息"),s.createElement("span",{className:"btn-outlined",onClick:e=>{this.setState({status:"modify_password"})}},"修改密码")))}render_edit_profile(){let e=this.state.myProfile_Editing;return s.createElement(s.Fragment,null,s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"昵称"),s.createElement("input",{className:"field-value",value:e.nickname?e.nickname:"",onChange:t=>{e.nickname=t.target.value,this.forceUpdate()}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"简介"),s.createElement("textarea",{className:"field-value",value:e.desc?e.desc:"",onChange:t=>{e.desc=t.target.value,this.forceUpdate()}})),s.createElement("div",null,s.createElement("span",{className:"btn",onClick:e=>this.setState({status:"display"})},"取消"),s.createElement("span",{className:"btn",style:{marginLeft:"2rem"},onClick:async t=>{await l("/api/operator/modify_my_profile","put",{nickname:e.nickname,desc:e.desc}),this.setState({myProfile:this.state.myProfile_Editing,status:"display"}),sessionStorage.nickname=e.nickname,n.broadcast("modify_my_profile",this.state.myProfile_Editing)}},"确定")))}render_modify_password(){let e=this.state.mpass;return s.createElement(s.Fragment,null,s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"老密码"),s.createElement("input",{type:"password",value:e.oldpass,onChange:t=>{e.oldpass=t.target.value,this.forceUpdate()}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"新密码"),s.createElement("input",{type:"password",value:e.newpass,onChange:t=>{e.newpass=t.target.value,this.forceUpdate()}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"确认新密码"),s.createElement("input",{type:"password",value:e.confpass,onChange:t=>{e.confpass=t.target.value,this.forceUpdate()}})),s.createElement("div",null,s.createElement("span",{className:"btn",onClick:e=>this.setState({status:"display"})},"取消"),s.createElement("span",{className:"btn",style:{marginLeft:"2rem"},onClick:async t=>{e.newpass===e.confpass?(await l("/api/operator/change_my_password","put",{old_password:e.oldpass,new_password:e.newpass}),alert("修改成功"),this.setState({status:"display"})):alert("新密码 和 确认密码 不同")}},"确定")))}render(){return s.createElement("div",{className:"result-list",style:{alignItems:"normal",margin:"4rem"}},"display"==this.state.status?this.render_display():"edit_profile"==this.state.status?this.render_edit_profile():"modify_password"==this.state.status?this.render_modify_password():null)}}class E extends s.Component{COLOR_SET=["red","green","blue","black","purple","orange","gray","OliveDrab","Olive","Chocolate","Brown","SkyBlue","Cyan","MediumOrchid"];constructor(e){super(e)}async componentDidMount(){let e=this;this.linechart=new Chart(document.getElementById("linechart"),{type:"line",data:{datasets:[]},options:{onClick:function(t,a){let s=a[0];if(!s)return;let n=s.index;var i=this.data.labels[n];e.updateBarChart(i,e.barchart_monthTable[i])},scales:{y:{type:"linear",display:!0,position:"left"},y1:{type:"linear",display:!0,position:"right",grid:{drawOnChartArea:!1}}}}}),this.barchart=new Chart(document.getElementById("barchart"),{type:"bar",data:{datasets:[]}});var t=await l("/api/operator/stats?by=month");e.analyzeStatsData(t.stats)}analyzeStatsData(e){let t=[],a=[{yAxisID:"y",label:"消费次数（左Y轴）",data:[],borderWidth:1,borderColor:this.COLOR_SET[0],tension:.25,pointRadius:1.5,hoverBorderWidth:3},{yAxisID:"y1",label:"消费金额（右Y轴）",data:[],borderWidth:1,borderColor:this.COLOR_SET[1],tension:.25,pointRadius:1.5,hoverBorderWidth:3}];this.barchart_monthTable={};for(var s=e.length-1;s>=0;s--){let n=e[s];t.push(n.month),a[0].data.push(n.times),a[1].data.push(n.fee),this.barchart_monthTable[n.month]=n.days}this.linechart.data.labels=t,this.linechart.data.datasets=a,this.linechart.update()}updateBarChart(e,t){let a=t.map((e=>e.day)),s=t.map((e=>e.fee));this.barchart.data={labels:a,datasets:[{label:`${e}月 每天消费额`,data:s,backgroundColor:this.COLOR_SET}]},this.barchart.update()}render(){return s.createElement(s.Fragment,null,s.createElement("canvas",{id:"linechart",style:{maxWidth:"900px",maxHeight:"400px",marginTop:"1rem"}}),s.createElement("canvas",{id:"barchart",style:{maxWidth:"900px",maxHeight:"400px",marginTop:"2rem"}}))}}class v extends s.Component{constructor(e){super(e),this.state={searchKeywords:"",selected:this.props.selectedItemOnStart}}componentDidMount(){this.props.keywordsChange(this.state.searchKeywords)}render(){return React.createElement(React.Fragment,null,this.ui_Part_SelectedItems(),this.ui_Part_SearchBox(),this.ui_Part_SelectBox())}ui_Part_SearchBox(){return React.createElement("input",{style:{marginTop:"1rem",display:"block",width:"10rem"},placeholder:"请输入关键字查找",value:this.state.searchKeywords,onChange:e=>{this.setState({searchKeywords:e.target.value})},onKeyDown:e=>{"Enter"==e.key&&this.props.keywordsChange(this.state.searchKeywords)}})}ui_Part_SelectBox(){return React.createElement("select",{size:"4",style:{width:"10rem"},onChange:e=>{let t=parseInt(e.target.value);for(var a of this.props.items)if(a[this.props.optionValue]===t){this.setState({selected:a}),this.props.selectionChange(a);break}}},this.props.items.map((e=>React.createElement("option",{key:e[this.props.optionValue],value:e[this.props.optionValue]},e[this.props.optionName]))))}ui_Part_SelectedItems(){return null===this.state.selected?null:React.createElement("span",{className:"btn",onClick:()=>{this.setState({selected:null}),this.props.selectionChange(null)}},this.state.selected[this.props.optionName])}}class y extends s.Component{constructor(e){super(e),this.state={items:[],searchKeywords:"",selected:this.props.selectedItemsOnStart}}async componentDidMount(){this.setState({items:await this.props.getItemFunction("")})}render(){return s.createElement("div",{style:{display:"flex",gap:"1rem"}},s.createElement("div",{style:{display:"flex",flexDirection:"column"}},this.ui_Part_SearchBox(),this.ui_Part_SelectBox()),s.createElement("div",{style:{display:"flex",gap:".5rem",padding:".1rem"}},this.ui_Part_SelectedItems()))}ui_Part_SearchBox(){return s.createElement("input",{style:{width:"10.6rem"},placeholder:"请输入关键字查找",value:this.state.searchKeywords,onChange:e=>{this.setState({searchKeywords:e.target.value})},onKeyDown:async e=>{"Enter"==e.key&&this.setState({items:await this.props.getItemFunction(this.state.searchKeywords)})}})}ui_Part_SelectBox(){return s.createElement("select",{size:"4",style:{width:"11rem",borderTop:"none"},onChange:e=>{let t=parseInt(e.target.value);for(var a of this.state.selected)if(a[this.props.optionValue]===t)return;for(var a of this.state.items)if(a[this.props.optionValue]===t){let e=[...this.state.selected,a];this.setState({selected:e}),this.props.selectionChange(e);break}}},this.state.items.map((e=>s.createElement("option",{key:e[this.props.optionValue],value:e[this.props.optionValue]},e[this.props.optionName]))))}ui_Part_SelectedItems(){return this.state.selected.map((e=>s.createElement("div",{key:e[this.props.optionValue]},s.createElement("span",{className:"btn-outlined",style:{margin:0}},e[this.props.optionName]),s.createElement("span",{className:"btn-outlined",style:{margin:0,borderLeft:"none"},onClick:()=>{let t=this.state.selected.indexOf(e),a=[...this.state.selected];a.splice(t,1),this.setState({selected:a}),this.props.selectionChange(a)}},"X"))))}}class f extends s.Component{constructor(e){super(e),this.state={searchKeywords:"",selected:this.props.selectedItemsOnStart}}componentDidMount(){this.props.keywordsChange(this.state.searchKeywords)}render(){return React.createElement(React.Fragment,null,this.ui_Part_SelectedItems(),this.ui_Part_SearchBox(),this.ui_Part_SelectBox())}ui_Part_SearchBox(){return React.createElement("input",{style:{marginTop:"1rem",display:"block",width:"10rem"},placeholder:"请输入关键字查找",value:this.state.searchKeywords,onChange:e=>{this.setState({searchKeywords:e.target.value})},onKeyDown:e=>{"Enter"==e.key&&this.props.keywordsChange(this.state.searchKeywords)}})}ui_Part_SelectBox(){return React.createElement("select",{size:"4",style:{width:"10rem"},onChange:e=>{let t=parseInt(e.target.value);for(var a of this.state.selected)if(a[this.props.optionValue]===t)return;for(var a of this.props.items)if(a[this.props.optionValue]===t){let e=[...this.state.selected,a];a.amount="",this.setState({selected:e}),this.props.selectionChange(e);break}}},this.props.items.map((e=>React.createElement("option",{key:e[this.props.optionValue],value:e[this.props.optionValue]},e[this.props.optionName]))))}ui_Part_SelectedItems(){return this.state.selected.map((e=>React.createElement("div",{key:e[this.props.optionValue]},React.createElement("span",{className:"btn"},e[this.props.optionName]),React.createElement("input",{type:"number",value:e.amount,onChange:t=>{e.amount=t.target.value,this.forceUpdate()}}),React.createElement("span",{className:"btn",onClick:()=>{let t=this.state.selected.indexOf(e),a=[...this.state.selected];a.splice(t,1),this.setState({selected:a}),this.props.selectionChange(a)}},"X"))))}}class N extends d{api_name="permission";constructor(e){super(e),this.deviceTypeList=[]}componentDidMount(){this.getItemList()}genAddOneItemGUI(){return s.createElement(s.Fragment,null,s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"权限名称"),s.createElement("input",{type:"text",id:"permission-name",className:"input-xl"})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"权限描述"),s.createElement("input",{type:"text",id:"permission-desc",className:"input-xl"})))}async addOneSubmit(){let e=document.querySelector("#permission-name").value,t=document.querySelector("#permission-desc").value;await l("/api/operator/permission/add","post",{name:e,desc:t}),this.getItemList()}genOneItemInnerElement(e){let t=this.state.pageItemModify[e.id];return t?s.createElement(s.Fragment,null,s.createElement("div",{className:"edit-one-form"},s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"权限名称"),s.createElement("input",{value:t.name,className:"input-xl",onChange:e=>{t.name=e.target.value,this.forceUpdate()}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"权限描述"),s.createElement("input",{value:t.desc,className:"input-xl",onChange:e=>{t.desc=e.target.value,this.forceUpdate()}}))),s.createElement("div",{className:"result-list-item-btn-bar"},s.createElement("span",{className:"btn-no-border",onClick:()=>{this.modifyOneSubmit(t,e)}},"确定"),s.createElement("span",{className:"btn-no-border",onClick:()=>{delete this.state.pageItemModify[e.id],this.forceUpdate()}},"取消"))):s.createElement(s.Fragment,null,s.createElement("div",{className:"result-list-item-info"},s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"权限名称"),s.createElement("span",null,e.name)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"权限描述"),s.createElement("span",null,e.desc))),s.createElement("div",{className:"result-list-item-btn-bar"},s.createElement("span",{className:"btn-no-border",onClick:()=>{this.deleteItem(e.id)}},"删除"),s.createElement("span",{className:"btn-no-border",onClick:()=>{this.state.pageItemModify[e.id]=JSON.parse(JSON.stringify(e)),this.forceUpdate()}},"修改")))}async modifyOneSubmit(e,t){await l("/api/operator/permission/modify","put",{id:t.id,name:e.name,desc:e.desc}),delete this.state.pageItemModify[t.id],this.getItemList(this.state.curPageNum)}}class b extends d{api_name="group";constructor(e){super(e),this.addPermissions=[]}componentDidMount(){this.getItemList()}async getPermissionListWithKeywords(e){var t=new URLSearchParams({pagesize:"50",pagenum:"1",keywords:e}).toString();return(await l("/api/operator/permission/list?"+t)).retlist}genAddOneItemGUI(){return s.createElement(s.Fragment,null,s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员组 名称"),s.createElement("input",{type:"text",id:"group-name",className:"input-xl"})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员组 描述"),s.createElement("input",{type:"text",id:"group-desc",className:"input-xl"})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员组 权限"),s.createElement(y,{getItemFunction:this.getPermissionListWithKeywords,optionName:"name",optionValue:"id",selectedItemsOnStart:[],selectionChange:e=>{this.addPermissions=e}})))}async addOneSubmit(){let e=document.querySelector("#group-name").value,t=document.querySelector("#group-desc").value,a=this.addPermissions.map((e=>e.id));await l("/api/operator/group/add","post",{name:e,desc:t,permissions:a}),this.getItemList()}genOneItemInnerElement(e){let t=this.state.pageItemModify[e.id];return t?s.createElement(s.Fragment,null,s.createElement("div",{className:"edit-one-form"},s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员组名称"),s.createElement("input",{value:t.name,className:"input-xl",onChange:e=>{t.name=e.target.value,this.forceUpdate()}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员组描述"),s.createElement("input",{value:t.desc,className:"input-xl",onChange:e=>{t.desc=e.target.value,this.forceUpdate()}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员组 权限"),s.createElement(y,{getItemFunction:this.getPermissionListWithKeywords,optionName:"name",optionValue:"id",selectedItemsOnStart:t.permissions,selectionChange:e=>{t.permissions=e}}))),s.createElement("div",{className:"result-list-item-btn-bar"},s.createElement("span",{className:"btn-no-border",onClick:()=>{this.modifyOneSubmit(t,e)}},"确定"),s.createElement("span",{className:"btn-no-border",onClick:()=>{delete this.state.pageItemModify[e.id],this.forceUpdate()}},"取消"))):s.createElement(s.Fragment,null,s.createElement("div",{className:"result-list-item-info"},s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员组名称"),s.createElement("span",null,e.name)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员组描述"),s.createElement("span",null,e.desc))),s.createElement("div",{className:"result-list-item-btn-bar"},s.createElement("span",{className:"btn-no-border",onClick:()=>{this.deleteItem(e.id)}},"删除"),s.createElement("span",{className:"btn-no-border",onClick:async()=>{let t=await l("/api/operator/group/get_permissions?group_id="+e.id);this.state.pageItemModify[e.id]=JSON.parse(JSON.stringify(e)),this.state.pageItemModify[e.id].permissions=t.permissions,this.forceUpdate()}},"修改")))}async modifyOneSubmit(e,t){await l("/api/operator/group/modify","put",{id:t.id,name:e.name,desc:e.desc,permissions:e.permissions.map((e=>e.id))}),delete this.state.pageItemModify[t.id],this.getItemList(this.state.curPageNum)}}class I extends d{api_name="operator";constructor(e){super(e),this.addPermissions=[],this.addGroups=[]}componentDidMount(){this.getItemList()}async getPermissionListWithKeywords(e){var t=new URLSearchParams({pagesize:"50",pagenum:"1",keywords:e}).toString();return(await l("/api/operator/permission/list?"+t)).retlist}async getGroupListWithKeywords(e){var t=new URLSearchParams({pagesize:"50",pagenum:"1",keywords:e}).toString();return(await l("/api/operator/group/list?"+t)).retlist}genAddOneItemGUI(){return s.createElement(s.Fragment,null,s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员 账号"),s.createElement("input",{type:"text",id:"operator-username",className:"input-xl"})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员 姓名"),s.createElement("input",{type:"text",id:"operator-nickname",className:"input-xl"})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员 密码"),s.createElement("input",{type:"text",id:"operator-password",className:"input-xl"})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员 描述"),s.createElement("input",{type:"text",id:"operator-desc",className:"input-xl"})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员  权限"),s.createElement(y,{getItemFunction:this.getPermissionListWithKeywords,optionName:"name",optionValue:"id",selectedItemsOnStart:[],selectionChange:e=>{this.addPermissions=e}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员 所属组 "),s.createElement(y,{getItemFunction:this.getGroupListWithKeywords,optionName:"name",optionValue:"id",selectedItemsOnStart:[],selectionChange:e=>{this.addGroups=e}})))}async addOneSubmit(){let e=document.querySelector("#operator-username").value,t=document.querySelector("#operator-nickname").value,a=document.querySelector("#operator-password").value,s=document.querySelector("#operator-desc").value;await l("/api/operator/operator/add","post",{username:e,nickname:t,password:a,desc:s,permissions:this.addPermissions.map((e=>e.id)),groups:this.addGroups.map((e=>e.id))}),this.getItemList()}genOneItemInnerElement(e){let t=this.state.pageItemModify[e.id];return t?s.createElement(s.Fragment,null,s.createElement("div",{className:"edit-one-form"},s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员 账号"),s.createElement("input",{value:t.username,className:"input-xl",onChange:e=>{t.username=e.target.value,this.forceUpdate()}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员 姓名"),s.createElement("input",{value:t.nickname,className:"input-xl",onChange:e=>{t.nickname=e.target.value,this.forceUpdate()}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员 描述"),s.createElement("input",{value:t.desc,className:"input-xl",onChange:e=>{t.desc=e.target.value,this.forceUpdate()}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员 权限"),s.createElement(y,{getItemFunction:this.getPermissionListWithKeywords,optionName:"name",optionValue:"id",selectedItemsOnStart:t.permissions,selectionChange:e=>{t.permissions=e}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"操作员 所属组"),s.createElement(y,{getItemFunction:this.getGroupListWithKeywords,optionName:"name",optionValue:"id",selectedItemsOnStart:t.groups,selectionChange:e=>{t.groups=e}}))),s.createElement("div",{className:"result-list-item-btn-bar"},s.createElement("span",{className:"btn-no-border",onClick:()=>{this.modifyOneSubmit(t,e)}},"确定"),s.createElement("span",{className:"btn-no-border",onClick:()=>{delete this.state.pageItemModify[e.id],this.forceUpdate()}},"取消"))):s.createElement(s.Fragment,null,s.createElement("div",{className:"result-list-item-info"},s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"账号"),s.createElement("span",null,e.username)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"姓名"),s.createElement("span",null,e.nickname)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"描述"),s.createElement("span",null,e.desc))),s.createElement("div",{className:"result-list-item-btn-bar"},s.createElement("span",{className:"btn-no-border",onClick:()=>{this.deleteItem(e.id)}},"删除"),s.createElement("span",{className:"btn-no-border",onClick:async()=>{this.state.pageItemModify[e.id]=JSON.parse(JSON.stringify(e));let t=await l("/api/operator/operator/get_permissions_groups?operator_id="+e.id);this.state.pageItemModify[e.id].permissions=t.permissions,this.state.pageItemModify[e.id].groups=t.groups,this.forceUpdate()}},"修改")))}async modifyOneSubmit(e,t){await l("/api/operator/operator/modify","put",{id:t.id,username:e.username,nickname:e.nickname,desc:e.desc,permissions:e.permissions.map((e=>e.id)),groups:e.groups.map((e=>e.id))}),delete this.state.pageItemModify[t.id],this.getItemList(this.state.curPageNum)}}class _ extends s.Component{api_name="customer";constructor(e){super(e);let t=r("username"),a=r("nickname");this.state={curPageNum:1,pagecount:0,gotoPageNum:"",pageItemList:[],pageItemModify:[],userName:t||"",nickName:a||""}}async componentDidMount(){this.getItemList()}genOneItemInnerElement(e){let t=this.state.pageItemModify[e.id];return void 0===t?s.createElement(s.Fragment,null,s.createElement("div",{className:"result-list-item-info"},s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"用户名"),s.createElement("span",{className:"field-value"},e.username)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"昵称"),s.createElement("span",{className:"field-value"},e.nickname)),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"余额"),s.createElement("span",{className:"field-value"},e.balance))),s.createElement("div",{className:"result-list-item-btn-bar"},s.createElement("span",{className:"btn-no-border",onClick:()=>{location.hash="#/svcrecord?username="+e.username}},"消费记录"),s.createElement("span",{className:"btn-no-border",onClick:()=>{this.state.pageItemModify[e.id]={action:"charing",amount:500,reason:""},this.forceUpdate()}},"给他充值"))):s.createElement(s.Fragment,null,s.createElement("div",{className:"result-list-item-info"},s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"充值金额"),s.createElement("input",{type:"number",value:t.amount,onChange:e=>{t.amount=e.target.value,this.forceUpdate()}})),s.createElement("div",{className:"field"},s.createElement("span",{className:"field-name"},"说明"),s.createElement("input",{type:"text",value:t.reason,onChange:e=>{t.reason=e.target.value,this.forceUpdate()}}))),s.createElement("div",{className:"result-list-item-btn-bar"},s.createElement("span",{className:"btn-no-border",onClick:async()=>{let a=await l(`/api/operator/${this.api_name}/charge_for_customer`,"put",{amount:parseFloat(t.amount),custid:e.id,reason:t.reason});alert(`充值成功，用户余额为: ${a.balance} 元`),delete this.state.pageItemModify[e.id],this.getItemList(this.state.curPageNum)}},"确定"),s.createElement("span",{className:"btn-no-border",onClick:()=>{delete this.state.pageItemModify[e.id],this.forceUpdate()}},"取消")))}async getItemList(e=1,t=5){this.setState({pageItemList:[]});let a="";""!=this.state.userName&&(a+="&username="+this.state.userName),""!=this.state.nickName&&(a+="&nickname="+this.state.nickName);let s=`/api/operator/${this.api_name}/list?pagesize=${t}&pagenum=${e}`;a.length>0&&(s+=a);var n=await l(s);let i=Math.ceil(n.total/t);this.setState({curPageNum:e,pagecount:i,pageItemList:n.retlist})}render(){return s.createElement(s.Fragment,null,s.createElement("div",{className:"filters",style:{display:"flex",flexDirection:"row",gap:"3rem",justifyContent:"center",margin:"1rem"}},s.createElement("div",{style:{display:"flex",gap:"1rem"}},s.createElement("div",{style:{display:"flex",gap:"1rem"}},s.createElement("span",null,"用户名"),s.createElement("input",{size:20,value:this.state.userName,onChange:e=>{let t=e.target.value.trim();m("username",t),this.setState({userName:t})}}))),s.createElement("div",{style:{display:"flex",gap:"1rem"}},s.createElement("div",{style:{display:"flex",gap:"1rem"}},s.createElement("span",null,"昵称"),s.createElement("input",{size:20,value:this.state.nickName,onChange:e=>{let t=e.target.value.trim();m("nickname",t),this.setState({nickName:t})}}))),s.createElement("span",{className:"btn",style:{width:"3rem"},onClick:e=>{this.getItemList()}},"查询")),0===this.state.pagecount?null:s.createElement("div",{className:"paginator"},s.createElement("span",{id:"curpage-totalpage",style:{color:"olive"}},"第",this.state.curPageNum,"页，共",this.state.pagecount,"页"),s.createElement("span",{className:"btn-no-border "+(1===this.state.curPageNum?"disable":""),onClick:()=>{1!==this.state.curPageNum&&this.getItemList(this.state.curPageNum-1)}},"上一页"),s.createElement("span",{className:"btn-no-border "+(this.state.curPageNum===this.state.pagecount?"disable":""),onClick:()=>{this.state.curPageNum!==this.state.pagecount&&this.getItemList(this.state.curPageNum+1)}},"下一页"),s.createElement("input",{type:"number",style:{width:"3rem"},min:"1",onChange:e=>{this.setState({gotoPageNum:e.target.value})},onKeyDown:e=>{if("Enter"!==e.key)return;let t=parseInt(this.state.gotoPageNum.trim());this.getItemList(t)}}),s.createElement("span",{id:"gotoPage",className:"btn-no-border",onClick:()=>{let e=parseInt(this.state.gotoPageNum.trim());this.getItemList(e)}},"跳转")),s.createElement("div",{className:"result-list"},0===this.state.pagecount?s.createElement("p",{style:{fontSize:"1.2rem"}}," 没有找到记录数据 "):this.state.pageItemList.map((e=>s.createElement("div",{className:"result-list-item",key:e.id},this.genOneItemInnerElement(e))))))}}var S=a(745),C=a(655),w=a(250);window.onload=function(){document.addEventListener("click",(function(e){let t=e.target.closest(".sub-nav-bar > .menu-item");if(t){let e=t.querySelector(".dropdown-menu");e&&(e.classList.contains("hidden")?e.classList.remove("hidden"):e.classList.add("hidden"))}let a=e.target.closest(".side-menu > .menu-item");if(a&&!e.target.closest(".sub-menu")){let e=a.querySelector("ul.sub-menu");e&&(e.classList.contains("hidden")?e.classList.remove("hidden"):e.classList.add("hidden"))}})),S.createRoot(document.querySelector("main")).render(s.createElement(C.UT,null,s.createElement(w.Z5,null,s.createElement(w.AW,{path:"/",element:s.createElement(o,null)}),s.createElement(w.AW,{path:"/devicemodel",element:s.createElement(p,null)}),s.createElement(w.AW,{path:"/device",element:s.createElement(o,null)}),s.createElement(w.AW,{path:"/svcrule",element:s.createElement(u,null)}),s.createElement(w.AW,{path:"/svcrecord",element:s.createElement(h,null)}),s.createElement(w.AW,{path:"/myprofile",element:s.createElement(g,null)}),s.createElement(w.AW,{path:"/stats",element:s.createElement(E,null)}),s.createElement(w.AW,{path:"/operator",element:s.createElement(I,null)}),s.createElement(w.AW,{path:"/group",element:s.createElement(b,null)}),s.createElement(w.AW,{path:"/permission",element:s.createElement(N,null)}),s.createElement(w.AW,{path:"/customer",element:s.createElement(_,null)})))),S.createRoot(document.getElementById("top-right")).render(s.createElement(c))}}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var a=n[e]={exports:{}};return s[e](a,a.exports,i),a.exports}i.m=s,e=[],i.O=(t,a,s,n)=>{if(!a){var l=1/0;for(d=0;d<e.length;d++){for(var[a,s,n]=e[d],r=!0,m=0;m<a.length;m++)(!1&n||l>=n)&&Object.keys(i.O).every((e=>i.O[e](a[m])))?a.splice(m--,1):(r=!1,n<l&&(l=n));if(r){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[a,s,n]},a=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,s){if(1&s&&(e=this(e)),8&s)return e;if("object"==typeof e&&e){if(4&s&&e.__esModule)return e;if(16&s&&"function"==typeof e.then)return e}var n=Object.create(null);i.r(n);var l={};t=t||[null,a({}),a([]),a(a)];for(var r=2&s&&e;"object"==typeof r&&!~t.indexOf(r);r=a(r))Object.getOwnPropertyNames(r).forEach((t=>l[t]=()=>e[t]));return l.default=()=>e,i.d(n,l),n},i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={171:0};i.O.j=t=>0===e[t];var t=(t,a)=>{var s,n,[l,r,m]=a,c=0;if(l.some((t=>0!==e[t]))){for(s in r)i.o(r,s)&&(i.m[s]=r[s]);if(m)var d=m(i)}for(t&&t(a);c<l.length;c++)n=l[c],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(d)},a=self.webpackChunkelife=self.webpackChunkelife||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var l=i.O(void 0,[343],(()=>i(541)));l=i.O(l)})();