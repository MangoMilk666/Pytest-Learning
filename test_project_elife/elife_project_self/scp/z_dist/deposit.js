import{jfetch as s}from"/share.js";export default class i extends React.Component{constructor(e){super(e);let t=location.hash.split("/");this.deviceSn=t[2],this.portNum=t[3],this.state={balance:0,depositRecords:[],showDepositRecords:!1},this.pageNum=1}async componentDidMount(){let e=await s("/api/customer/get-my-info");this.setState({balance:e.balance})}async deposit(e){let t=await s("/api/customer/deposit","POST",{amount:e});this.setState({balance:t.balance}),setTimeout(()=>{alert(`充值成功，当前余额为：${t.balance}`)},0)}CS_AMOUNT(e){return React.createElement("div",{className:"block",onClick:()=>this.deposit(e)},React.createElement("span",{className:"icon"}),React.createElement("div",null,e," 元"))}render(){return React.createElement("div",{className:"home"},React.createElement("div",{className:"topbar",style:{color:"#03a9f4",margin:"1rem"}},sessionStorage.displayName," ，余额 ",this.state.balance,React.createElement("div",{style:{float:"right",cursor:"pointer"},onClick:()=>{location.hash="#/home"}},"返回主页")),React.createElement("div",{className:"functions"},this.CS_AMOUNT(50),this.CS_AMOUNT(100),this.CS_AMOUNT(200),this.CS_AMOUNT(300),this.CS_AMOUNT(400),this.CS_AMOUNT(500)),React.createElement("div",{className:"query",style:{display:"flex",flexDirection:"column",alignItems:"center"}},React.createElement("div",{style:{margin:"2rem 0",padding:"1rem 0",cursor:"pointer",textAlign:"center",color:"#03a9f4",borderBottom:"1px solid #d9eff8;"},onClick:async()=>{if(this.state.showDepositRecords){this.setState({showDepositRecords:!1});return}this.pageNum=1;let e=await s("/api/customer/deposit-history?pagenum=1");this.setState({depositRecords:e.records,showDepositRecords:!0})}},"充值记录")),this.state.showDepositRecords?React.createElement("div",{className:"result-list"},this.state.depositRecords.length===0?React.createElement("p",null,"没有记录"):React.createElement(React.Fragment,null,this.state.depositRecords.map(e=>React.createElement("div",{className:"result-list-item",key:e.id},React.createElement("div",{style:{color:"gray"}},e.time.substring(0,16).replace("T"," ")),React.createElement("div",{style:{color:"#4caf50"}},e.amount),React.createElement("div",{style:{color:"#4caf50"}},(t=>t==4?"集团付款":"自行充值")(e.deposit_type)))),React.createElement("div",{style:{padding:"1rem 0",cursor:"pointer",textAlign:"center",color:"#03a9f4",borderBottom:"1px solid #4caf50;"},onClick:async()=>{this.pageNum+=1;let e=await s("/api/customer/deposit-history?pagenum="+this.pageNum);e.records.length>0?this.setState({depositRecords:[...this.state.depositRecords,...e.records]}):(this.pageNum-=1,alert("没有更多记录了"))}},"更多记录"))):null)}}
