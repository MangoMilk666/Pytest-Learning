class u{constructor(){this.subscribers=[]}subscribe(s){this.subscribers.push(s)}broadcast(s,i){for(let n of this.subscribers)n.handleDCEvent(s,i)}}const b=new u;export{b as DC};var o={};export async function jfetch(t,s="get",i={},n=!0,h={},f=!1){let e={method:s,...h};if(s==="get"){let c=new URLSearchParams(i).toString();if(c.length>0&&(t+="?"+c),f&&(delete e.trycache,o.hasOwnProperty(t)))return o[t]}else e.headers=e.headers?e.headers:{},e.headers={"Content-Type":"application/json",...e.headers},e.body=JSON.stringify(i);n&&(e.headers={Authorization:"Bearer "+sessionStorage.elifeToken,...e.headers});const r=await fetch(t,e);if(r.status===401){alert(r.status+" \uFF1A\u8BF7\u652F\u4ED8\u5B9D\u626B\u7801\u8BBE\u5907\u4E8C\u7EF4\u7801\u767B\u5F55");return}if(r.status!==200)throw alert("HTTP \u9519\u8BEF : "+r.status),"HTTP \u9519\u8BEF : "+r.status;let a=await r.json();if(a.ret!=0&&a.ret>0)throw alert(a.msg),a.msg;return h.trycache&&(o[t]=a),a}
